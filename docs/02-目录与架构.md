# 02｜目录与架构

## 主题目录（核心）

- `functions.php`：主题功能主入口（钩子、设置、查询、优化）
- `style.css`：主题元信息入口（不承载主要业务样式）
- `assets/css/base.css`：全站基础样式与主题变量
- `assets/css/weekly.css`：周刊相关样式
- `assets/css/blog.css`：博客页面样式
- `assets/css/idea.css`：闪念页面样式
- `assets/js/idea-page.js`：闪念页面前端交互脚本
- `header.php` / `footer.php`：全站框架
- `index.php`：首页与通用文章渲染
- `archive.php`：分类/归档页面（含周刊分类特殊展示）
- `search.php`：搜索模板
- `blog.php`：博客页面模板
- `idea.php`：闪念页面模板
- `weekly.php`：周刊页面模板
- `404.php`：404 页面

## 运行架构

### 1. 主题初始化

`functions.php` 中 `dear_setup()` 完成：

- `after_setup_theme` 钩子注册
- 菜单位置注册（`primary-menu`）
- 基础主题支持能力启用

### 2. 样式与脚本加载

`yayu_load_style()` 在 `wp_enqueue_scripts` 中执行：

- 加载 `style.css`（元信息）与模块化 CSS（`base/weekly/blog/idea`）
- 注入前端内联脚本（主题切换）
- 在 `idea.php` 模板页面按需加载 `assets/js/idea-page.js`

### 3. 后台可配置项（Customizer）

`functions.php` 定义两类设置：

- 闪念设置：分类名、内容截断长度、卡片圆角
- 周刊设置：网格列数、卡片间距

### 4. 查询改写

通过 `pre_get_posts` 等钩子实现：

- 首页/归档分页数量控制
- 将闪念内容从部分公共列表中排除
- 由独立模板承载闪念主展示

## 数据与显示关系

- 闪念内容来源：按分类查询（优先使用分类标识 slug，未命中回退分类名称）
- 周刊内容来源：固定使用 `weekly` 分类
- 亮暗模式状态：浏览器 `localStorage`（键：`dear-theme`）

## 设计边界

- 本主题坚持“极简优先”，避免重型依赖。
- 交互以少量原生 JS 实现，不依赖前端框架。
- 若新增复杂模块，需先评估是否违背主题定位。
